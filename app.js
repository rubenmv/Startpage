var app=angular.module("startpageApp",[]).config(["$compileProvider",function(t){t.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|chrome-extension):/),t.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|chrome-extension):/)}],"$sceDelegateProvider",function(t){t.resourceUrlWhitelist(["self","https://api.flickr.com/**"])});app.factory("weatherFactory",["$http","$q",function(t,e){"use strict";function o(o){var r=e.defer(),a="select * from weather.forecast where woeid in (select woeid from geo.places(1) where text='"+o+"') and u='c'",c="https://query.yahooapis.com/v1/public/yql?q="+a+"&format=json&env=store://datatables.org/Falltableswithkeys";return t.get(c).success(function(t){r.resolve(t.query.results)}).error(function(t){console.log("Error retrieving markets"),r.reject(t)}),r.promise}return{getWeather:o}}]),app.controller("weatherController",["$scope","$timeout","weatherFactory",function(t,e,o){"use strict";function r(e){t.place=e,t.weatherVisible=!0}t.fetchWeather=function(e,a){null!==e&&void 0!==e&&""!==e&&o.getWeather(e).then(function(o){var c=null;if(null===o||void 0===o)return void console.log("Cannot retrieve weather, response is null");c=o.channel,e!==t.location,localStorage.setItem("location",e),t.location=e;var l=c.item.condition.code;parseInt(l)<10&&(l="0"+l),c.item.condition.code=l,l=a?c.item.forecast:c.item.forecast.slice(0,5);for(var n=0;n<l.length;n++)l[n].code<10&&(l[n].code="0"+l[n].code);c.item.forecast=l,localStorage.setItem("weatherData",JSON.stringify(c)),r(c)},function(t){console.error("getWeather deferred promise reject: "+t)})},t.weatherVisible=!1,t.location=localStorage.getItem("location"),null===t.location?(t.location="Madrid, Spain",localStorage.setItem("location",t.location)):void 0!==t.location&&""!==t.location.trim()||(t.location="Madrid, Spain",localStorage.setItem("location",t.location)),t.fullForecast=localStorage.getItem("fullForecast"),null!==t.fullForecast&&void 0!==t.fullForecast||(t.fullForecast=!1,localStorage.setItem("fullForecast",!1)),t.fullForecast="true"==t.fullForecast;var a=localStorage.getItem("weatherData");null!==a&&void 0!==a&&(a=JSON.parse(a),r(a)),document.getElementById("full_forecast").checked=t.fullForecast,t.fetchWeather(t.location,t.fullForecast),e(function(){document.getElementById("body").style.opacity=1},100),t.saveSettings=function(e,o){void 0!==e&&""!==e.trim()&&(void 0===o&&(o=!1),localStorage.setItem("fullForecast",o),t.fullForecast=o,t.fetchWeather(e,t.fullForecast))}}]),app.factory("flickrFactory",["$http","$q",function(t,e){"use strict";function o(o){var r=e.defer(),a="https://api.flickr.com/services/feeds/photos_public.gne?format=json&jsoncallback=angular.callbacks._0&tagmode="+o.tagmode+"&tags="+o.tags;return t({method:"JSONP",url:a,params:[{format:"jsonp",jsoncallback:"JSON_CALLBACK"}]}).success(function(t){r.resolve(t)}).error(function(t){console.log("Error retrieving flickr data: "+t),r.reject(t)}),r.promise}return{getImagesByTags:o}}]),app.controller("backgroundController",["$scope","$timeout","flickrFactory",function(t,e,o){"use strict";t.getBackground=function(t){o.getImagesByTags({tags:t,tagmode:"any"}).then(function(t){var e=t.items;if(e.length>0){var o=Math.floor(Math.random()*e.length),r=e[o].media.m.replace("_m","_b");document.body.style.background="url("+r+") no-repeat center center fixed",document.body.style.backgroundSize="cover"}})["catch"](function(t){console.error("Error retrieving images from Flickr: "+JSON.stringify(t))})},t.location=localStorage.getItem("location"),null===t.location?(t.location="Madrid, Spain",localStorage.setItem("location",t.location)):void 0!==t.location&&""!==t.location.trim()||(t.location="Madrid, Spain",localStorage.setItem("location",t.location)),t.getBackground(t.location)}]),app.controller("timeController",["$scope","$timeout",function(t,e){"use strict";t.clock=Date.now(),t.tickInterval=1e3;var o=function(){t.clock=Date.now(),e(o,t.tickInterval)};e(o,t.tickInterval)}]);