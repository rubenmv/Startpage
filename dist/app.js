var app=angular.module("startpageApp",[]).config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|chrome-extension):/),e.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|chrome-extension):/)}]);app.factory("weatherFactory",["$http","$q",function(e,t){"use strict";function o(o){var a=t.defer(),r="select * from weather.forecast where woeid in (select woeid from geo.places(1) where text='"+o+"') and u='c'",i="https://query.yahooapis.com/v1/public/yql?q="+r+"&format=json&env=store://datatables.org/Falltableswithkeys";return e.get(i).success(function(e){a.resolve(e.query.results)}).error(function(e){console.log("Error retrieving markets"),a.reject(e)}),a.promise}return{getWeather:o}}]),app.controller("weatherController",["$scope","$timeout","weatherFactory",function(e,t,o){"use strict";function a(t){e.place=t,e.weatherVisible=!0}e.fetchWeather=function(t,r){null!==t&&void 0!==t&&""!==t&&o.getWeather(t).then(function(o){var i=null;if(null===o||void 0===o)return void console.log("Cannot retrieve weather, response is null");i=o.channel,t!==e.location,localStorage.setItem("location",t),e.location=t;var l=i.item.condition.code;parseInt(l)<10&&(l="0"+l),i.item.condition.code=l,l=r?i.item.forecast:i.item.forecast.slice(0,5);for(var c=0;c<l.length;c++)l[c].code<10&&(l[c].code="0"+l[c].code);i.item.forecast=l,localStorage.setItem("weatherData",JSON.stringify(i)),a(i)},function(e){console.error("getWeather deferred promise reject: "+e)})},e.weatherVisible=!1,e.location=localStorage.getItem("location"),null===e.location?(e.location="Madrid, Spain",localStorage.setItem("location",e.location)):void 0!==e.location&&""!==e.location.trim()||(e.location="Madrid, Spain",localStorage.setItem("location",e.location)),e.fullForecast=localStorage.getItem("fullForecast"),null!==e.fullForecast&&void 0!==e.fullForecast||(e.fullForecast=!1,localStorage.setItem("fullForecast",!1)),e.fullForecast="true"==e.fullForecast;var r=localStorage.getItem("weatherData");null!==r&&void 0!==r&&(r=JSON.parse(r),a(r)),document.getElementById("full_forecast").checked=e.fullForecast,e.fetchWeather(e.location,e.fullForecast),t(function(){document.getElementById("body").style.opacity=1},100),e.saveSettings=function(t,o){void 0!==t&&""!==t.trim()&&(void 0===o&&(o=!1),localStorage.setItem("fullForecast",o),e.fullForecast=o,e.fetchWeather(t,e.fullForecast))}}]),app.factory("flickrFactory",["$http","flickrSearchDataService",function(e,t){var o={};return o.getImagesFromUserById=function(o){var a=t.getNew("imagesFromUserById",o);return e({method:"JSONP",url:a.url,params:a.object})},o.getImagesFromGroupOfUsersByIds=function(o){var a=t.getNew("imagesFromGroupOfUsersByIds",o);return e({method:"JSONP",url:a.url,params:a.object})},o.getImagesByTags=function(o){var a=t.getNew("imagesByTags",o);return e({method:"JSONP",url:a.url,params:a.object})},o}]),app.service("flickrSearchDataService",function(){this.getApiBaseUrl=function(e){return"https://api.flickr.com/services/feeds/photos_public.gne"},this.fillDataInObjectByList=function(e,t,o){return angular.forEach(o,function(o,a){angular.isDefined(t[o])&&(e.object[o]=t[o])}),e},this.getNew=function(e,t){var o={object:{jsoncallback:"JSON_CALLBACK",format:"json"},url:""};switch(e){case"imagesFromUserById":o=this.fillDataInObjectByList(o,t,["lang","id"]),o.url=this.getApiBaseUrl();break;case"imagesFromGroupOfUsersByIds":o=this.fillDataInObjectByList(o,t,["lang","ids"]),o.url=this.getApiBaseUrl();break;case"imagesByTags":o=this.fillDataInObjectByList(o,t,["lang","tags","tagmode"]),o.url=this.getApiBaseUrl()}return o}}),app.controller("backgroundController",["$scope","$timeout","flickrFactory",function(e,t,o){"use strict";e.getBackground=function(e){o.getImagesByTags({tags:e,tagmode:"any"}).then(function(e){var t=e.data.items;if(t.length>0){var o=Math.floor(Math.random()*t.length),a=t[o].media.m.replace("_m","_b");document.body.style.background="url("+a+") no-repeat center center fixed",document.body.style.backgroundSize="cover"}})["catch"](function(e){console.error("Error retrieving images from Flickr: "+JSON.stringify(e))})},e.location=localStorage.getItem("location"),null===e.location?(e.location="Madrid, Spain",localStorage.setItem("location",e.location)):void 0!==e.location&&""!==e.location.trim()||(e.location="Madrid, Spain",localStorage.setItem("location",e.location)),e.getBackground(e.location)}]),app.controller("timeController",["$scope","$timeout",function(e,t){"use strict";e.clock=Date.now(),e.tickInterval=1e3;var o=function(){e.clock=Date.now(),t(o,e.tickInterval)};t(o,e.tickInterval)}]);